## 后端PHP代码

> 文件名 app/api/logic/Photo.php (直接覆盖即可)

```php
<?php

namespace app\api\logic;

use think\Db;

class Photo extends ApiBase
{
    public function searchPhotos(
        $page, $pageSize, $transferor, $payee, $amountMin, $amountMax,
        $startTime, $endTime, $startUploadTime, $endUploadTime, $content
    )
    {
        $db = Db::name('Photo');
        $totalQuery = Db::name('Photo');
        $where = [];

        if (!empty($transferor)) {
            $where['transferor'] = ['like', '%'.$transferor.'%'];
        }

        if (!empty($payee)) {
            $where['payee'] = ['like', '%'.$payee.'%'];
        }

        if (!empty($amountMin)) {
            $db->where(function($query) use ($amountMin) {
                $query->where("CAST(amount AS DECIMAL(10, 2)) >= '$amountMin'");
            });
            $totalQuery->where(function($query) use ($amountMin) {
                $query->where("CAST(amount AS DECIMAL(10, 2)) >= '$amountMin'");
            });
        }

        if (!empty($amountMax)) {
            $db->where(function($query) use ($amountMax) {
                $query->where("CAST(amount AS DECIMAL(10, 2)) <= '$amountMax'");
            });
            $totalQuery->where(function($query) use ($amountMax) {
                $query->where("CAST(amount AS DECIMAL(10, 2)) <= '$amountMax'");
            });
        }

        if (!empty($content) && is_array($content)) {
            $db->where(function($query) use ($content) {
                foreach ($content as $v) {
                    $query->where('content', 'like', '%' . $v . '%');
                }
            });
        }

        $field = ['id', 'key', 'transferor', 'payee', 'amount', 'date_time', 'upload_time', 'content'];
        if (!empty($startTime)) {
            $db->where(function($query) use ($startTime) {
                $query->where("STR_TO_DATE(date_time, '%Y-%m-%d') >= '$startTime'");
            });
            $totalQuery->where(function($query) use ($startTime) {
                $query->where("STR_TO_DATE(date_time, '%Y-%m-%d') >= '$startTime'");
            });
        }

        if (!empty($endTime)) {
            $db->where(function($query) use ($endTime) {
                $query->where("STR_TO_DATE(date_time, '%Y-%m-%d') <= '$endTime'");
            });
            $totalQuery->where(function($query) use ($endTime) {
                $query->where("STR_TO_DATE(date_time, '%Y-%m-%d') <= '$endTime'");
            });
        }

        if (!empty($startUploadTime)) {
            $db->where('upload_time', '>=', $startUploadTime);
            $totalQuery->where('upload_time', '>=', $startUploadTime);
        }

        if (!empty($endUploadTime)) {
            $db->where('upload_time', '<=', $endUploadTime);
            $totalQuery->where('upload_time', '<=', $endUploadTime);
        }

        $offset = ($page - 1) * $pageSize;
        $db->where($where);
        $records = $db->field($field)->order('date_time asc')->limit($offset, $pageSize)->select();

        // 查询总数
        if (!empty($content) && is_array($content)) {
            $totalQuery->where(function($query) use ($content) {
                foreach ($content as $v) {
                    $query->where('content', 'like', '%' . $v . '%');
                }
            });
        }
        $total = $totalQuery->where($where)->count();

        return [
            'records' => $records,
            'total' => $total,
        ];
    }

    public function findFileWthKey($key)
    {
        $where['key'] = $key;
        $data = Db::name("Photo")->where($where)->find();
        return $data;
    }
}
```

## 前端参考

(问题修复)[https://github.com/supkit/photo/issues/1]



